---
title: "Valgrind 練習"
description: "記錄我從頭開始學習 valgrind 的用法和例子，有時間的話會再去了解背後的運作"
date: 2025-08-30 12:00:00 +0800
categories: [Careers, Linux]
tags: [Tech, Linux, Valgrind]
---

### Installation

```sh
sudo apt update
sudo apt install valgrind
```

### Memory Leakage

```cpp
#include <stdlib.h>

int main()
{
    int *arr = malloc(10 * sizeof(int));
    arr[0] = 123;
    // free(arr);
    return 0;  
}
```
{: file='leak.c'}

```sh
gcc -g -o leak leak.c
valgrind --leak-check=full ./leak

LEAK SUMMARY:
   definitely lost: 40 bytes in 1 blocks
```

### Invalid Write

```c
#include <stdlib.h>

int main() {
    int *arr = malloc(5 * sizeof(int));
    for (int i = 0; i <= 5; i++) {  // Should be < 5
        arr[i] = i;
    }
    free(arr);
    return 0;
}
```
{: file='invalid_write.c'}

```sh
gcc -g -o invalid_write invalid_write.c
valgrind ./invalid_write

Invalid write of size 4
   at  main (invalid_write.c:7)
 Address 0x... is 0 bytes after a block of size 20 alloc'd

```

### Use After Free

```c
#include <stdlib.h>
#include <stdio.h>

int main()
{
    int *x = malloc(sizeof(int));
    *x = 42;
    free(x);
    printf("%d\n", *x);
    return 0;
}
```
{file='use_after_free.c'}

```sh
gcc -g -o use_after_free use_after_free.c
valgrind ./use_after_free

Invalid read of size 4
   at  main (use_after_free.c:9)
 Address 0x... is 0 bytes inside a block of size 4 free'd

```

### Uninitialized Memory

```c
#include <stdlib.h>
#include <stdio.h>

int main() {
    int *x = malloc(sizeof(int));
    printf("%d\n", *x);
    free(x);
    return 0;
}
```
{file='uninit.c'}

```sh
gcc -g -o uninit uninit.c
valgrind ./uninit

Use of uninitialised value of size 4
   at  main (uninit.c:8)
```