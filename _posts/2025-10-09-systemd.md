---
title: "Systemd 簡介"
date: 2025-10-9 00:00:00 +0800
categories: [Careers, Notes]
tags: [Tech, Linux]
---

## 前言

最近因為工作上的需求學會了 systemd 這個工具，原本使用自己寫的 script 作為監控程式來看其他程式的存歿，但是又需要需要監控這個監控用的程式的問題 (雖然稍微好好寫基本上是不會死掉)，但還是會害怕有意外，也可能是我在系統維護的思維還不構成熟，知道的操作不夠完備才有的擔憂，總之我今天花了一天搞懂了 systemd 大部分的操作並且放到生產環境做事了。

## 功能及優點

systemd 是一個監控程式，可以確保需要保持運作的程式持續運作，並且在異常或任何理由停止運作的時候重新啟動，也可以簡單的透過指令啟動停止重啟，並且有紀錄 log 以及多種彈性設定，包含:

- 開機自行啟動
- 服務和服務之間的依賴關係/時間先後關係/部分組件關係
: 例如可以等待開機後，網路狀態穩定才開始，又或者是依賴於另一個同為 systemd 的服務
- 在什麼條件退出時要重啟 (錯誤退出/正常退出/永不重啟/總是重啟)
- 退出時執行的另一個程式 (可以用來通知或寫紀錄)

使用 systemd 最大的優勢是他是 ubuntu (以及某些其他 Linux 發行版) 內建的程式，穩定度和方便性最高，接著讓我們來看要怎麼使用 systemd

## 使用步驟

一個 systemd 的任務叫做 Unit，需要在目錄 `/etc/systemd/system/` 創建一個新的檔案 `<mydaemon>.service`

也就是執行: `sudo nano /etc/systemd/system/<mydaemon>.service`

然後在裡面寫你要做的事，以下為範例

```
[Unit]
Description=My Custom Daemon
After=network.target
Requires=network.target

[Service]
Type=simple
User=myuser
ExecStart=/usr/local/bin/<mydaemon> --option
Restart=on-failure
RestartSec=5
# 可選：健康檢查腳本
# ExecStartPre=/usr/local/bin/check_env.sh

[Install]
WantedBy=multi-user.target
```

存檔之後執行 `sudo systemctl daemon-reload` 才會被讀入

```
# 開機自啟動
sudo systemctl enable <mydaemon>
sudo systemctl disable <mydaemon>

# 其他操作

sudo systemctl start <mydaemon>
sudo systemctl stop <mydaemon>
sudo systemctl restart <mydaemon>
sudo systemctl status <mydaemon>
```

其他細節有空再補

