---
title: "為什麼 Process 的 root 可能不是系統的 root"
# description: 
date: 2025-08-11 12:00:00 +0800
categories: [Careers, Linux]
tags: [Tech, Linux]
---

>本頁施工中，尚未整理完成
{: .prompt-warning }

我們可以看這個案例

```
root@XXX:/proc/1249# ls -l | grep ^l
lrwxrwxrwx  1 root  root   0 Apr  1 15:48 cwd -> /etc/avahi
lrwxrwxrwx  1 root  root   0 Mar 31 11:03 exe -> /usr/sbin/avahi-daemon
lrwxrwxrwx  1 root  root   0 Apr  1 15:48 root -> /etc/avahi
```

對系統來說 root 路徑是一種物理邊界的安全機制，避免程式受到攻擊後去試圖獲取系統 root 底下的機密資訊

權限檢查和檔案可見性是兩回事

chroot 前：
程式可以「看到」整個檔案系統的路徑結構（ls、stat），只是打開檔案時可能會被權限拒絕。
這有時會洩漏檔名、路徑、結構等資訊。

chroot 後：
對 process 來說，外面的路徑根本不存在，它連 /etc 目錄都找不到，更不用談猜測檔名。



1. 應用程式隔離（安全 sandbox）
目的：限制應用程式只能看到指定目錄，防止它誤讀或竄改系統檔案。

例子：

nginx、bind（DNS 伺服器）會用 chroot 限制程式只能讀到 /var/www 或 /var/named。

一旦程式被攻破，攻擊者也只能在那個目錄範圍活動。

為什麼有效：它改變了 / 的起點，所以即使用 /etc/passwd 讀檔，也只能讀到 chroot 目錄內的那個檔案。

2. 容器技術
目的：讓每個容器像擁有獨立系統一樣運作。

例子：

Docker、Podman、LXC 都會建立新的 mount namespace，再透過 pivot_root 切換到容器映像檔的根目錄。

容器內的 / 實際上可能是宿主機 /var/lib/docker/overlay2/.../merged。

好處：

每個容器檔案系統互相隔離。

可以同時在同一台機器上跑不同版本的 Linux 發行版。

3. 建置或測試不同系統環境
目的：在同一台機器上切換到另一個 root 環境進行測試。

例子：

用 debootstrap 在 /srv/debian-test 建好一個 Debian root，chroot /srv/debian-test 進去測試套件。

不用開 VM，就能測試新版本的套件或系統。

額外用途：可以交叉編譯，或在不同 libc、kernel headers 下測試程式。